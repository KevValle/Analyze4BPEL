[{"type":"VARIABLE","activityName":"inputVariable"},{"type":"VARIABLE","activityName":"outputVariable"},{"type":"VARIABLE","activityName":"tempMSNResult"},{"type":"VARIABLE","activityName":"div2counter_final"},{"type":"VARIABLE","activityName":"Google_doGoogleSearch_OutputVariable"},{"type":"VARIABLE","activityName":"maxGoogle"},{"type":"VARIABLE","activityName":"done_msn"},{"type":"VARIABLE","activityName":"div2counter_maxResults"},{"type":"VARIABLE","activityName":"generalFault"},{"type":"VARIABLE","activityName":"Google_doGoogleSearch_InputVariable"},{"type":"VARIABLE","activityName":"counter"},{"type":"VARIABLE","activityName":"currentItem"},{"type":"VARIABLE","activityName":"MSNSearch_Search_OutputVariable"},{"type":"VARIABLE","activityName":"maxMSN"},{"type":"VARIABLE","activityName":"added"},{"type":"VARIABLE","activityName":"done_google"},{"type":"VARIABLE","activityName":"MSNSearch_Search_InputVariable"},{"type":"VARIABLE","activityName":"doAdd"},{"type":"VARIABLE","activityName":"tempGoogleResult"},{"to":{"part":"payload","variable":"generalFault"},"from":{"client:root":"client:root","client:MetaSearchProcessFault_4":"\n\t\t\t\t\t ","client:message":"client:message","client:MetaSearchProcessFault_2":"\n\t\t\t\t\t ","client:MetaSearchProcessFault":"\n\t\t\t\t\t "},"activity":{"type":"ASSIGN","activityName":"CreateFault"}},{"to":{"bpel:query":"client:message","part":"payload","variable":"generalFault"},"from":{"xml-fragment":"'Problem while executing MetaSearch'"},"activity":{}},{"to":{"bpel:query":"client:root","part":"payload","variable":"generalFault"},"from":{"xml-fragment":"'See instance for detail'"},"activity":{}},{"portType":"{http:\/\/examples.bpelunit.org\/MetaSearch}MetaSearch","operation":"process","partnerLink":"client","messageExchange":"null","type":"RECEIVE","variable":"inputVariable","activityName":"receiveInput","createInstance":"yes"},{"to":{"variable":"done_google"},"from":{"xml-fragment":"false()"},"activity":{"type":"ASSIGN","activityName":"GoogleNotDone"}},{"to":{"part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"typens:GoogleSearchRequestElement":"\n\t\t\t\t\t\t\t\t\t","max":"0","start":"0","lr":"lr","query":"query","restrict":"restrict","key":"key","bpel:literal":"\n\t\t\t\t\t\t\t\t\t"},"activity":{"type":"ASSIGN","activityName":"InitializeGoogleValues"}},{"to":{"bpel:query":"key","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"xml-fragment":"string('insert KEY here')"},"activity":{}},{"to":{"bpel:query":"query","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"bpel:query":"client:query","part":"payload","variable":"inputVariable"},"activity":{}},{"to":{"bpel:query":"restrict","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"bpel:query":"client:country","part":"payload","variable":"inputVariable"},"activity":{}},{"to":{"bpel:query":"lr","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"bpel:query":"client:language","part":"payload","variable":"inputVariable"},"activity":{}},{"to":{"bpel:query":"start","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"bpel:query":"max","part":"request","variable":"Google_doGoogleSearch_InputVariable"},"from":{"xml-fragment":"number(10)"},"activity":{}},{"portType":"{http:\/\/examples.bpelunit.org\/GoogleBridge}GoogleSearchPort","operation":"doGoogleSearch","inputVariable":"Google_doGoogleSearch_InputVariable","partnerLink":"Google","outputVariable":"Google_doGoogleSearch_OutputVariable","type":"INVOKE","activityName":"Google"},{"to":{"variable":"done_google"},"from":{"xml-fragment":"true()"},"activity":{"type":"ASSIGN","activityName":"GoogleDone"}},{"to":{"variable":"done_msn"},"from":{"xml-fragment":"false()"},"activity":{"type":"ASSIGN","activityName":"MSNNotDone"}},{"to":{"part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"tns:ResultFields":"Title Description Url","tns:Source":"Web","tns:Longitude":"0.0","tns:CultureInfo":"tns:CultureInfo","tns:Count":"10","tns:Latitude":"0.0","tns:Search":"\n\t\t\t\t\t\t\t\t\t","tns:Flags":"None","tns:Offset":"0","tns:SafeSearch":"Moderate","tns:Query":"tns:Query","tns:AppID":"tns:AppID","tns:Radius":"5.0"},"activity":{"type":"ASSIGN","activityName":"InitializeMSNValues"}},{"to":{"bpel:query":"ns2:Request\/ns2:AppID","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"string('Insert key here')"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Query","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"bpel:query":"client:query","part":"payload","variable":"inputVariable"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:CultureInfo","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'dummy'"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:SafeSearch","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'Off'"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Flags","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'None'"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Requests\/ns2:SourceRequest\/ns2:Source","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'Web'"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Requests\/ns2:SourceRequest\/ns2:Offset","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Requests\/ns2:SourceRequest\/ns2:Count","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"number(15)"},"activity":{}},{"to":{"bpel:query":"ns2:Request\/ns2:Requests\/ns2:SourceRequest\/ns2:ResultFields","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'All'"},"activity":{}},{"else":"yes","condition":"(($inputVariable.payload\/client:country != '') and ($inputVariable.payload\/client:language != ''))","type":"IF","activityName":"Switch_10"},{"to":{"bpel:query":"ns2:Request\/ns2:CultureInfo","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"concat(concat($inputVariable.payload\/client:language, '-'), $inputVariable.payload\/client:country)"},"activity":{"type":"ASSIGN","activityName":"ConcatLangAndCountry"}},{"to":{"bpel:query":"ns2:Request\/ns2:CultureInfo","part":"parameters","variable":"MSNSearch_Search_InputVariable"},"from":{"xml-fragment":"'en-US'"},"activity":{"type":"ASSIGN","activityName":"UseDefaulten-US"}},{"portType":"{http:\/\/schemas.microsoft.com\/MSNSearch\/2005\/09\/fex}MSNSearchPortType","operation":"Search","inputVariable":"MSNSearch_Search_InputVariable","partnerLink":"MSN","outputVariable":"MSNSearch_Search_OutputVariable","type":"INVOKE","activityName":"MSNSearch"},{"to":{"variable":"done_msn"},"from":{"xml-fragment":"true()"},"activity":{"type":"ASSIGN","activityName":"MSNDone"}},{"else":"yes","condition":"((boolean($done_google) = true()) or (boolean($done_msn) = true()))","type":"IF","activityName":"IsDoneAtAll"},{"to":{"part":"payload","variable":"outputVariable"},"from":{"client:noResult":"0","client:MetaSearchProcessResponse":"\n\t\t\t\t\t\t\t\t\t","client:noFromMSN":"0","client:noFromGoogle":"0"},"activity":{"type":"ASSIGN","activityName":"CounterToOne"}},{"to":{"variable":"added"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"bpel:query":"client:noResult","part":"payload","variable":"outputVariable"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"bpel:query":"client:noFromGoogle","part":"payload","variable":"outputVariable"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"bpel:query":"client:noFromMSN","part":"payload","variable":"outputVariable"},"from":{"xml-fragment":"number(0)"},"activity":{}},{"to":{"variable":"div2counter_maxResults"},"from":{"xml-fragment":"$inputVariable.payload\/client:maxResults"},"activity":{}},{"else":"yes","condition":"$done_msn","type":"IF","activityName":"Switch_2"},{"to":{"variable":"maxMSN"},"from":{"xml-fragment":"count($MSNSearch_Search_OutputVariable.parameters\/ns2:Response\/ns2:Responses\/ns2:SourceResponse\/ns2:Results\/ns2:Result)"},"activity":{"type":"ASSIGN","activityName":"GetMaxMSDNNo"}},{"to":{"bpel:query":"client:noFromMSN","part":"payload","variable":"outputVariable"},"from":{"variable":"maxMSN"},"activity":{}},{"to":{"variable":"maxMSN"},"from":{"xml-fragment":"number(0)"},"activity":{"type":"ASSIGN","activityName":"MaxNo0"}},{"else":"yes","condition":"$done_google","type":"IF","activityName":"Switch_1"},{"to":{"variable":"maxGoogle"},"from":{"xml-fragment":"count($Google_doGoogleSearch_OutputVariable.return\/result)"},"activity":{"type":"ASSIGN","activityName":"GetMaxGoogleNo"}},{"to":{"bpel:query":"client:noFromGoogle","part":"payload","variable":"outputVariable"},"from":{"variable":"maxGoogle"},"activity":{}},{"to":{"variable":"maxGoogle"},"from":{"xml-fragment":"number(0)"},"activity":{"type":"ASSIGN","activityName":"MaxNo0"}},{"else":"yes","condition":"$maxGoogle > $maxMSN","type":"IF","activityName":"GoogleHasMoreResults"},{"to":{"variable":"div2counter_final"},"from":{"xml-fragment":"-1 + 2*$maxGoogle"},"activity":{"type":"ASSIGN","activityName":null}},{"to":{"variable":"div2counter_final"},"from":{"xml-fragment":"-1 + 2*$maxMSN"},"activity":{"type":"ASSIGN","activityName":null}},{"else":"no","condition":"$maxGoogle + $maxMSN < $div2counter_maxResults","type":"IF","activityName":"NotEnoughResultsToReachMax"},{"to":{"xml-fragment":"$div2counter_maxResults"},"from":{"xml-fragment":"$maxGoogle + $maxMSN"},"activity":{"type":"ASSIGN","activityName":null}},{"else":"no","condition":"$div2counter_maxResults > 0","type":"IF","activityName":"ClientResultsCondition"},{"finalCounterValue":"$div2counter_final","pararel":"no","type":"FOREACH","activityName":"InterleaveResults","completionCondition":"","startCounterValue":"0"},{"to":{"variable":"counter"},"from":{"xml-fragment":"1 + floor($div2counter div 2)"},"activity":{"type":"ASSIGN","activityName":"InitializeCounter"}},{"else":"yes","condition":"(($div2counter mod 2) = 0)","type":"IF","activityName":"IfEvenIteration"},{"else":"yes","condition":"($counter <= $maxGoogle)","type":"IF","activityName":"GoogleHasResult"},{"to":{"variable":"tempGoogleResult"},"from":{"title":"title","typens:result":"\n\t\t\t\t\t\t\t\t\t\t","snippet":"snippet","url":"url","bpel:literal":"\n\t\t\t\t\t\t\t\t\t\t"},"activity":{"type":"ASSIGN","activityName":"AssignTempGoogleElement"}},{"to":{"variable":"tempGoogleResult"},"from":{"xml-fragment":"$Google_doGoogleSearch_OutputVariable.return\/result[$counter]"},"activity":{}},{"to":{"variable":"currentItem"},"from":{"client:snippet":"client:snippet","bpel:literal_6":"\n\t\t\t\t\t\t\t\t\t\t\t","client:url":"client:url","client:from":"client:from","client:result":"\n\t\t\t\t\t\t\t\t\t\t\t","client:title":"client:title","bpel:literal":"\n\t\t\t\t\t\t\t\t\t\t"},"activity":{"type":"ASSIGN","activityName":"CreateGoogleElement"}},{"to":{"bpel:query":"client:url","variable":"currentItem"},"from":{"bpel:query":"url","variable":"tempGoogleResult"},"activity":{}},{"to":{"bpel:query":"client:title","variable":"currentItem"},"from":{"bpel:query":"title","variable":"tempGoogleResult"},"activity":{}},{"to":{"bpel:query":"client:snippet","variable":"currentItem"},"from":{"bpel:query":"snippet","variable":"tempGoogleResult"},"activity":{}},{"to":{"bpel:query":"client:from","variable":"currentItem"},"from":{"xml-fragment":"'Google'"},"activity":{}},{"else":"yes","condition":"($counter <= $maxMSN)","type":"IF","activityName":"MSNHasResult"},{"to":{"variable":"tempMSNResult"},"from":{"tns:Source":"tns:Source","tns:CacheUrl":"tns:CacheUrl","tns:Title":"tns:Title","tns:DisplayUrl":"tns:DisplayUrl","tns:SearchTags":"tns:SearchTags","tns:Url":"tns:Url","tns:Description":"tns:Description","tns:Result":"\n\t\t\t\t\t\t\t\t\t\t\t\t","bpel:literal":"\n\t\t\t\t\t\t\t\t\t\t\t\t"},"activity":{"type":"ASSIGN","activityName":"AssignTempMSNElement"}},{"to":{"variable":"tempMSNResult"},"from":{"xml-fragment":"$MSNSearch_Search_OutputVariable.parameters\/ns2:Response\/ns2:Responses\/ns2:SourceResponse\/ns2:Results\/ns2:Result[$counter]"},"activity":{}},{"to":{"variable":"currentItem"},"from":{"client:snippet":"client:snippet","client:url":"client:url","client:from":"client:from","bpel:literal":"\n\t\t\t\t\t\t\t\t\t\t\t","client:result":"\n\t\t\t\t\t\t\t\t\t\t\t","client:title":"client:title"},"activity":{"type":"ASSIGN","activityName":"CreateMSNElement"}},{"to":{"bpel:query":"client:url","variable":"currentItem"},"from":{"bpel:query":"ns2:Url","variable":"tempMSNResult"},"activity":{}},{"to":{"bpel:query":"client:title","variable":"currentItem"},"from":{"bpel:query":"ns2:Title","variable":"tempMSNResult"},"activity":{}},{"to":{"bpel:query":"client:snippet","variable":"currentItem"},"from":{"xml-fragment":"'dummy'"},"activity":{}},{"to":{"bpel:query":"client:from","variable":"currentItem"},"from":{"xml-fragment":"'MSN'"},"activity":{}},{"else":"yes","condition":"(count($tempMSNResult\/ns2:Description) > 0)","type":"IF","activityName":"MSNResultHasDescription"},{"to":{"bpel:query":"client:snippet","variable":"currentItem"},"from":{"bpel:query":"ns2:Description","variable":"tempMSNResult"},"activity":{"type":"ASSIGN","activityName":"AddDescription"}},{"to":{"variable":"doAdd"},"from":{"xml-fragment":"true()"},"activity":{"type":"ASSIGN","activityName":"InitializeDoAdd"}},{"finalCounterValue":"count($outputVariable.payload\/client:result)","pararel":"no","type":"FOREACH","activityName":"ScanResultsForMatch","completionCondition":"no","startCounterValue":"1"},{"else":"no","condition":"$outputVariable.payload\/client:result[$currentResultNumber]\/client:url = $currentItem\/client:url","type":"IF","activityName":"Switch_6"},{"to":{"variable":"doAdd"},"from":{"xml-fragment":"false()"},"activity":{"type":"ASSIGN","activityName":"doNotAdd"}},{"else":"yes","condition":"($doAdd = true())","type":"IF","activityName":"Switch_7"}]